# Frontend Guide

This guide explains how the Skibidi News UI is structured, how it talks to the router API, and how to extend it safely. Pair it with `docs/COMPONENT_GUIDE.md` (backend map) and `docs/DEPLOYMENT.md` (stack bringup).

---

## Tech Stack

- **React 19 + Vite 7** (`skibidi-news-frontend/`)
- **TypeScript-friendly JSX** (components are `.tsx`, top-level page is `.jsx`)
- **Tailwind CSS 3** for styling via `src/index.css` and `tailwind.config.js`
- **Lucide Icons + Framer Motion** for accents
- **Fetch + Axios** for HTTP calls (fetch for simple GET/POST, axios where response parsing is more involved)

Scripts live in `package.json`:

```bash
npm install
npm run dev      # Vite dev server
npm run build    # Production build
npm run preview  # Preview production output
npm run lint     # ESLint (per eslint.config)
```

---

## Directory Highlights

| Path                                               | Purpose                                                                     |
| -------------------------------------------------- | --------------------------------------------------------------------------- |
| `src/pages/Dashboard.jsx`                          | Main experience: orchestrates the pipeline panels and shared state.         |
| `src/components/NewsPanel.tsx`                     | Fetch summarized news via `/news`.                                          |
| `src/components/HumorPanel.tsx`                    | Sends summaries to `/humorize_news`.                                        |
| `src/components/AudioPanel.tsx`                    | Calls `/studio/generate` to get transcript + video.                         |
| `src/components/YoutubePanel.tsx`                  | Handles OAuth via Google Identity Services and posts to `/youtube/publish`. |
| `src/components/layout/Header.tsx` & `Sidebar.tsx` | Global chrome and progress indicators.                                      |
| `src/components/ui/PanelShell.tsx`                 | Shared container component with accent props.                               |
| `src/api/*.ts`                                     | Thin wrappers around router endpoints (see below).                          |
| `src/api/socials/youtube.ts`                       | Browser-only OAuth helper for Google/YouTube uploads.                       |
| `src/assets/`                                      | Static assets (icons, etc.).                                                |

---

## State Flow

`Dashboard.jsx` keeps four pieces of state and passes them down the pipeline:

1. `summary` ← set by `NewsPanel` after calling `fetchNewsSummary()`.
2. `humor` ← set by `HumorPanel` via `humorizeText(summary)`.
3. `audioUrl` + `videoId` ← set by `AudioPanel` with `generateStudioAsset(humorText)`.
4. `youtubeAuthToken` ← maintained by `YoutubePanel` (optional publish step).

`onClear` from `NewsPanel` resets the entire pipeline (clears humor/audio/video) so the UI always reflects fresh data.

---

## API Clients

All HTTP base URLs resolve through `src/api/config.ts` and default to the router (`VITE_ROUTER_API_BASE`, falls back to `http://127.0.0.1:8000`). When running in Docker Compose, the frontend container injects the correct base automatically.

| Function                                          | Endpoint                                                                              | Notes                                                                                                    |
| ------------------------------------------------- | ------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------- |
| `fetchNewsSummary(category?)`                     | `GET /news?category=`                                                                 | Returns `{ summary, category, available_categories }`. Normalizes category labels in the UI.             |
| `humorizeText(newsText)`                          | `POST /humorize_news`                                                                 | Wraps payload expected by `router_agent` (`{ news: str }`). Returns `huomrized_news`.                    |
| `generateStudioAsset(humorText, backgroundVideo)` | `POST /studio/generate`                                                               | Returns `{ transcript, video_id, video_url }`; falls back to `/videos/{id}` URL if backend omits `_url`. |
| `fetchBestPrompt(prompt, summary, allowQuickOpt)` | `POST /prompt/best`                                                                   | Displays prompt optimizer output in `PromptLab` (panel is currently commented out but ready).            |
| `uploadToYouTube(params)`                         | `POST /youtube/publish`                                                               | Requires OAuth token generated by `authenticateYouTube()`.                                               |
| `authenticateYouTube()`                           | Client-side OAuth flow for the YouTube upload scope; stores tokens in `localStorage`. |

Environment variables (see `.env.example`):

```
VITE_ROUTER_API_BASE=http://127.0.0.1:8000
VITE_YOUTUBE_CLIENT_ID=...
VITE_YOUTUBE_CLIENT_SECRET=...
```

Older per-service bases (`VITE_NEWS_API_BASE`, etc.) are still supported but unused once the router is in front of everything.

---

## Styling System

- `PanelShell` wraps each major section with consistent padding, borders, and accent gradients.
- Tailwind is configured via `tailwind.config.js` (container centering, custom fonts, etc.).
- Global styles live in `src/index.css`; prefer utility classes over bespoke CSS.
- Components use semantic HTML (`section`, `article`, `header`) plus `aria` attributes where needed for accessibility.

---

## Adding a New Panel

1. Create a component under `src/components/YourPanel.tsx` and wrap content in `PanelShell` for consistency.
2. Hook into `Dashboard` state by lifting new pieces of state to `Dashboard.jsx`. Pass setters down as props.
3. Define any new API clients in `src/api/` so fetch logic stays in one place (avoid calling `fetch` directly inside components).
4. Update `Sidebar` badges or CTAs if the new panel impacts perceived pipeline progress.

---

## YouTube OAuth Notes

- `YoutubePanel` calls `authenticateYouTube()` from `src/api/socials/youtube.ts`.
- Tokens are cached in `localStorage` and checked via `isTokenExpired` before reuse.
- Set `VITE_YOUTUBE_CLIENT_ID` (and optional secret) in `.env`. Without it the panel will throw an explicit error.

---

## Troubleshooting

| Symptom                           | Likely cause                                               | Fix                                                |
| --------------------------------- | ---------------------------------------------------------- | -------------------------------------------------- |
| Fetch buttons spin forever        | Router not running or wrong `VITE_ROUTER_API_BASE`.        | Hit `http://127.0.0.1:8000/ping` or update `.env`. |
| `generateStudioAsset` returns 502 | Text-to-video MCP offline.                                 | Check `docker compose logs mcp_text_to_video`.     |
| YouTube auth popup blocked        | Browser blocked popups.                                    | Allow popups for `localhost:5173`.                 |
| Tailwind styles missing           | Forgot to restart Vite after editing `tailwind.config.js`. | `npm run dev` again.                               |

---

Use this guide whenever you need to tweak the UI or wire new MCP tools into the dashboard without re-reading every component.
